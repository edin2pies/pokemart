{% extends "base.html" %}
{% block content %}
<h2>Add a new Pokémon Card</h2>
<form method="POST" onsubmit="return validateForm();">
    {{ form.hidden_tag() }}

    <p>
        <label for="pokemon-name">Select Pokémon:</label><br>
        <select id="pokemon-name" name="pokemon_name" onchange="populateDescription()">
            <option value="">Select a Pokémon</option>
            <!-- Pokémon options will be populated here -->
        </select>
    </p>
    <p>
        <label for="description">Description:</label><br>
        <textarea id="description" name="description" cols="40" rows="5" readonly></textarea>
    </p>
    <p>
        {{ form.price.label }}<br>
        {{ form.price() }}<br>
        {% for error in form.price.errors %}
            <span class="error">{{ error }}</span>
        {% endfor %}
    </p>
    <p>
        {{ form.image_url.label }}<br>
        {{ form.image_url(size=64) }}<br>
        {% for error in form.image_url.errors %}
            <span class="error">{{ error }}</span>
        {% endfor %}
    </p>
    <p>
        {{ form.stock.label }}<br>
        {{ form.stock() }}<br>
        {% for error in form.stock.errors %}
            <span class="error">{{ error }}</span>
        {% endfor %}
    </p>
    <p>{{ form.submit() }}</p>
</form>

<script>
    let pokemonDescriptions = {};

    // Fetch Pokémon data on page load
    fetch('/api/pokemon')
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById("pokemon-name");
            data.forEach(pokemon => {
                const option = document.createElement("option");
                option.value = pokemon.name;
                option.textContent = pokemon.name;
                select.appendChild(option);
                
                // Store the description in an object for easy access
                pokemonDescriptions[pokemon.name] = pokemon.description;
            });
        });

    function populateDescription() {
        const select = document.getElementById("pokemon-name");
        const descriptionArea = document.getElementById("description");
        const selectedPokemon = select.value;
        
        // Populate the description area with the selected Pokémon's description
        descriptionArea.value = selectedPokemon ? pokemonDescriptions[selectedPokemon] : '';
    }
</script>

{% endblock %}